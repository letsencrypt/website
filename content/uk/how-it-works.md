---
title: Як це працює
linkTitle: Як працює Let's Encrypt
slug: how-it-works
top_graphic: 3
lastmod: 2019-10-18
---

{{< lastmod >}}

Метою Let's&nbsp;Encrypt та [протоколу ACME](https://tools.ietf.org/html/rfc8555) є можливість налаштування HTTPS сервера та отримання сертифікату без втручання людини.  Це відбувається завдяки запущеному на на веб-сервері агента керування сертифікатами.

Щоб краще зрозуміти як ця технологія працює, давайте налаштуємо агента керування сертифікатами від Let's&nbsp;Encrypt для умовного сайту `https://example.com/`.

Це відбудеться у два кроки.  Спершу агент надсилає підтвердження в Центр Сертифікації, що сервер контролює цей домен.  Після того, агент може просити нові, оновлювати та відкликати сертифікати для цього домена.

## Перевірка домену

Let's&nbsp;Encrypt ідентифікує адміністратора сервера за публічним ключем.  Коли агент взаємодіє з Let's&nbsp;Encrypt вперше, він генерує нову пару ключів і підтверджує ЦС Let's&nbsp;Encrypt, що цей сервер контролює один або декілька доменів.  Це схоже на традиційний процес створення облікового запису у ЦС і додавання доменів до цього облікового запису.

Кожного разу на початку, агент запитує ЦС Let's Encrypt що потрібно зробити, щоб довести, що він контролює `example.com`.  В залежності від домена, ЦС Let's&nbsp;Encrypt видає один чи кілька наборів перевірок, що мають бути проведені.   Агент може підтвердити контроль над доменом кількома способами.  ЦС дозволяє підтверджувати контроль такими способами:

* Створюючи додатковий DNS запис для `example.com`, чи
* Створюючи HTTP сторінку на `http://example.com/`, з вказаною URI адресою

Разом з перевірками контролю домена, ЦС Let's Encrypt перевіряє чи агент контролює ключі шифрування, надсилаючи одноразовий пароль який агент має підписати своїм приватним ключем.

<div class="howitworks-figure">
<img alt="Запит перевірок для домену example.com"
     src="/images/howitworks_challenge.png"/>
</div>

Агент виконує одну з запропонованих перевірок.   Скажімо, він може виконати друге завдання: він створює файл зі вказаним шляхом, і той файл є доступний з домену `http://example.com`.  Агент також підписує наданий одноразовий пароль своїми приватними ключем.  Після того, як агент завершив ці кроки, він повідомляє ЦС про готовність до завершення перевірки.

Наступний крок - робота ЦС.  ЦС звіряє підпис одноразового пароля, завантажує файл, що був створений для перевірки та перевіряє його вміст.

<div class="howitworks-figure">
<img alt="Запит авторизації для дій від імені example.com"
     src="/images/howitworks_authorization.png"/>
</div>

Якщо цифровий підпис вірний і решту перевірок здійснено - агенту дається право керувати сертифікатами для домена `example.com`.  Пара ключів (відкритий і приватний ключі), що використовувалася при перевірці прав на домен, називається "авторизованою парою ключів" для `example.com`.


## Видача та відкликання сертифікатів

Як тільки агент має авторизовану пару ключів, запит нових, поновлення, і відкликання сертифікатів стає простішим простого. Агент просто надсилає запит і підписує їх цими ключами.

Щоб отримати сертифікат для домену, агент створює [PKCS#10 запит](https://tools.ietf.org/html/rfc2986) та просить ЦС Let's&nbsp;Encrypt видати сертифікат для `example.com` з певним відкритим ключем.  Як завжди, CSR включає цифровий підпис приватним ключем, що відповідає публічному ключеві у CSR.  Агент також підписує весь CSR авторизованою парою ключів для `example.com`.

Коли ЦС Let's&nbsp;Encrypt отримує запит, він перевіряє обидва підписи.  Якщо все добре, видається сертифікат для `example.com` з публічним ключем з CSR і повертається агентові.

<div class="howitworks-figure">
<img alt="Запит сертифікату для example.com"
     src="/images/howitworks_certificate.png"/>
</div>

Процес відкликання сертифікату працює схожим чином.  Агент підписує запит на відкликання авторизованою парою ключів для `example.com` і ЦС Let's&nbsp;Encrypt перевіряє підпис.  Якщо підпис підтверджено, інформація про відкликання публікується у звичайні канали відкликання (тобто OCSP), щоб відповідні сторони, такі як браузери, могли знати, що вони не повинні приймати відкликаний сертифікат.

<div class="howitworks-figure">
<img alt="Запит на відкликання сертифікату для example.com"
     src="/images/howitworks_revocation.png"/>
</div>



